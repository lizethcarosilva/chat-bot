
 INICIO RÁPIDO - NUEVAS MÉTRICAS DE NEGOCIO


⏱  TIEMPO ESTIMADO: 10 minutos



PASO 1: CREAR TABLAS EN LA BASE DE DATOS (5 min)


Opción A - Desde terminal:


psql -h gondola.proxy.rlwy.net -p 22967 -U postgres -d railway -f crear_tablas_productos_ventas.sql


Opción B - Desde un cliente PostgreSQL (pgAdmin, DBeaver, etc.):


1. Conecta a tu base de datos
2. Abre el archivo: crear_tablas_productos_ventas.sql
3. Ejecuta todo el contenido

 Esto creará:
   • Tabla: producto
   • Tabla: venta
   • Tabla: detalle_venta
   • 10 productos de ejemplo
   • Triggers automáticos



PASO 2: INICIAR LA API (1 min)


Desde tu terminal en la carpeta del proyecto:

    python api.py

Deberías ver:

     LISTO - Presiona Ctrl+C para detener
     Servidor corriendo en: http://localhost:8000



PASO 3: PROBAR EN EL NAVEGADOR (2 min)


Abre en tu navegador:

    http://localhost:8000/docs

Busca la sección: "Métricas de Negocio" (debería estar color verde)

Prueba estos endpoints:

1. GET /api/metricas/cantidad-productos
   Click en "Try it out"  "Execute"
   
   Deberías ver:
   {
     "total_productos": 10,
     "mensaje": "Total de productos en inventario: 10"
   }

2. GET /api/metricas/dashboard
   Click en "Try it out"  "Execute"
   
   Verás todas las métricas en una sola respuesta



PASO 4: PROBAR CON EL CHATBOT (2 min)


Opción A - Desde Swagger UI:


1. En http://localhost:8000/docs
2. Busca: POST /api/chat
3. Click "Try it out"
4. En el body, escribe:

{
  "mensaje": "¿Cuántos productos tenemos?",
  "usuario_id": "test"
}

5. Click "Execute"


Opción B - Desde terminal:


curl -X POST "http://localhost:8000/api/chat" \
     -H "Content-Type: application/json" \
     -d '{"mensaje": "Muéstrame el inventario", "usuario_id": "test"}'


Opción C - Desde tu React:


fetch('http://localhost:8000/api/chat', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    mensaje: "¿Hay productos por vencer?",
    usuario_id: "user123"
  })
})
  .then(res => res.json())
  .then(data => console.log(data.respuesta));



 PREGUNTAS PARA PROBAR CON EL BOT


Prueba estas preguntas (una por una):

 "¿Cuántos productos tenemos?"
 "Muéstrame el inventario"
 "¿Hay productos con bajo stock?"
 "¿Hay productos próximos a vencer?"
 "Muéstrame las alertas"
 "¿Cuánto hemos vendido?"  (mostrará 0 si no hay ventas)
 "¿Cuántas citas hay hoy?"  (mostrará 0 si no hay citas para hoy)



 CREAR UNA VENTA DE PRUEBA (OPCIONAL)


Si quieres ver ventas reales, ejecuta esto en tu base de datos:

-- Crear una venta
INSERT INTO venta (client_id, fecha_venta, metodo_pago, descuento, impuesto, user_id)
VALUES (1, CURRENT_TIMESTAMP, 'Efectivo', 0, 0, 1)
RETURNING venta_id;

-- Supongamos que retornó venta_id = 1
-- Agregar productos a la venta
INSERT INTO detalle_venta (venta_id, producto_id, cantidad, precio_unitario, subtotal)
VALUES
    (1, 1, 2, 65.00, 130.00),   -- 2 bolsas de alimento
    (1, 4, 3, 7.50, 22.50),      -- 3 juguetes
    (1, 5, 1, 15.00, 15.00);     -- 1 shampoo

Ahora pregunta al bot:
  "¿Cuánto hemos vendido hoy?"



 EJEMPLO RÁPIDO EN REACT


Copia y pega este componente en tu React:

import React, { useState, useEffect } from 'react';

function Dashboard() {
  const [metrics, setMetrics] = useState(null);

  useEffect(() => {
    fetch('http://localhost:8000/api/metricas/dashboard')
      .then(res => res.json())
      .then(data => setMetrics(data))
      .catch(err => console.error(err));
  }, []);

  if (!metrics) return <div>Cargando...</div>;

  return (
    <div style={{ padding: '20px', fontFamily: 'Arial' }}>
      <h1> Dashboard Pet Store</h1>
      
      <div style={{ 
        display: 'grid', 
        gridTemplateColumns: 'repeat(4, 1fr)', 
        gap: '20px',
        marginTop: '20px'
      }}>
        <div style={{ 
          background: '#f0f9ff', 
          padding: '20px', 
          borderRadius: '10px',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '40px' }}></div>
          <h3>Citas Hoy</h3>
          <p style={{ fontSize: '32px', fontWeight: 'bold' }}>
            {metrics.citas_hoy.total}
          </p>
        </div>

        <div style={{ 
          background: '#f0fdf4', 
          padding: '20px', 
          borderRadius: '10px',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '40px' }}></div>
          <h3>Productos</h3>
          <p style={{ fontSize: '32px', fontWeight: 'bold' }}>
            {metrics.productos.total}
          </p>
        </div>

        <div style={{ 
          background: '#fefce8', 
          padding: '20px', 
          borderRadius: '10px',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '40px' }}></div>
          <h3>Ventas Día</h3>
          <p style={{ fontSize: '32px', fontWeight: 'bold' }}>
            ${metrics.ventas_dia.total_ventas.toFixed(2)}
          </p>
        </div>

        <div style={{ 
          background: '#faf5ff', 
          padding: '20px', 
          borderRadius: '10px',
          textAlign: 'center'
        }}>
          <div style={{ fontSize: '40px' }}></div>
          <h3>Ventas Mes</h3>
          <p style={{ fontSize: '32px', fontWeight: 'bold' }}>
            ${metrics.ventas_mes.total_ventas.toFixed(2)}
          </p>
        </div>
      </div>

      {/* Alertas */}
      <div style={{ marginTop: '30px' }}>
        {metrics.productos_proximos_vencer.criticos > 0 && (
          <div style={{ 
            background: '#fee', 
            padding: '15px', 
            borderRadius: '8px',
            marginBottom: '10px',
            borderLeft: '4px solid red'
          }}>
            <strong> ALERTA:</strong> {metrics.productos_proximos_vencer.criticos} productos críticos por vencer
          </div>
        )}
        
        {metrics.bajo_inventario.total_alertas > 0 && (
          <div style={{ 
            background: '#ffe', 
            padding: '15px', 
            borderRadius: '8px',
            borderLeft: '4px solid orange'
          }}>
            <strong> ADVERTENCIA:</strong> {metrics.bajo_inventario.total_alertas} productos con bajo stock
          </div>
        )}
      </div>

      {/* Tendencia */}
      <div style={{ marginTop: '30px', textAlign: 'center' }}>
        <h3>Tendencia de Ventas</h3>
        <p style={{ fontSize: '48px' }}>
          {metrics.comparativa_ventas.tendencia === 'crecimiento' ? '' : ''}
        </p>
        <p style={{ 
          fontSize: '24px',
          color: metrics.comparativa_ventas.porcentaje_cambio > 0 ? 'green' : 'red'
        }}>
          {metrics.comparativa_ventas.porcentaje_cambio > 0 ? '+' : ''}
          {metrics.comparativa_ventas.porcentaje_cambio.toFixed(2)}%
        </p>
      </div>
    </div>
  );
}

export default Dashboard;



 VERIFICACIÓN RÁPIDA


Marca lo que ya completaste:

 Tablas creadas en la base de datos
 API iniciada (http://localhost:8000)
 Swagger UI funciona (http://localhost:8000/docs)
 Endpoint /api/metricas/cantidad-productos retorna 10 productos
 Chatbot responde preguntas de inventario
 Dashboard React funcionando (opcional)



 SOLUCIÓN DE PROBLEMAS RÁPIDA


Problema: "Tabla 'producto' no existe"

Solución: Ejecuta el script SQL crear_tablas_productos_ventas.sql


Problema: API no inicia

Solución: 
  python -m pip install fastapi uvicorn psycopg2
  python api.py


Problema: Productos muestran 0

Normal si acabas de crear las tablas.
El script SQL ya inserta 10 productos de ejemplo.
Verifica con:
  SELECT COUNT(*) FROM producto;


Problema: React no conecta

Verifica:
  1. API corriendo en http://localhost:8000
  2. CORS configurado en api.py (ya está)
  3. URL correcta en fetch



 MÁS INFORMACIÓN


Para documentación completa:
   METRICAS_NEGOCIO.md

Para resumen detallado:
   NUEVAS_METRICAS_RESUMEN.txt

Para ejemplos de código React:
   METRICAS_NEGOCIO.md (sección "Componentes React")

Documentación interactiva:
   http://localhost:8000/docs



 ¡LISTO PARA USAR!


Tu sistema ahora incluye:

 7 nuevas métricas de negocio
 8 nuevos endpoints REST
 Chatbot con análisis de ventas e inventario
 Dashboard completo
 Alertas automáticas
 Comparativas de rendimiento

¡Disfruta del análisis con IA! 

